<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR –Ø–ª–∏–Ω–∫–∞ –∑ –≥—ñ—Ä–ª—è–Ω–¥–æ—é</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a472a, #2d5a27);
            color: white;
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            color: #ffd700;
        }

        .ar-container {
            width: 100%;
            height: 50vh;
            min-height: 300px;
            margin: 0 auto 20px;
            border: 3px solid #ffd700;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            background: #000;
        }

        #ar-scene {
            width: 100%;
            height: 100%;
            display: block;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: #2d5a27;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border: 2px solid #ffd700;
        }

        .btn:hover {
            background: #3a7c32;
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.active {
            background: #4CAF50;
            color: white;
        }

        .status {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .status p {
            margin: 5px 0;
        }

        .instructions {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .instructions h3 {
            color: #ffd700;
            margin-bottom: 10px;
        }

        .instructions ol {
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .marker-section {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .marker-section h3 {
            color: #ffd700;
            margin-bottom: 10px;
        }

        #markerPreview {
            max-width: 250px;
            border-radius: 10px;
            border: 3px solid #ffd700;
            margin: 10px auto;
            display: block;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å */
        @media (max-width: 768px) {
            .controls {
                grid-template-columns: 1fr;
            }
            
            .ar-container {
                height: 40vh;
            }
            
            .header h1 {
                font-size: 24px;
            }
        }

        @media (max-width: 480px) {
            .btn {
                padding: 12px;
                font-size: 14px;
            }
            
            .ar-container {
                height: 35vh;
                min-height: 250px;
            }
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å */
        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px;
            background: #4CAF50;
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-three.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/build/three.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÑ AR –Ø–ª–∏–Ω–∫–∞ –∑ –≥—ñ—Ä–ª—è–Ω–¥–æ—é</h1>
            <p>–ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä —Ç–∞ —Å–∫–∞–∂—ñ—Ç—å "–Ø–ª–∏–Ω–æ—á–∫–∞ –≥–æ—Ä–∏!"</p>
        </div>
        
        <div class="ar-container">
            <canvas id="ar-scene"></canvas>
        </div>
        
        <div class="controls">
            <button id="start-button" class="btn">üöÄ –°—Ç–∞—Ä—Ç AR</button>
            <button id="music-toggle" class="btn">üéµ –£–≤—ñ–º–∫. –º—É–∑–∏–∫—É</button>
            <button id="mic-toggle" class="btn">üé§ –£–≤—ñ–º–∫. –º—ñ–∫—Ä–æ—Ñ–æ–Ω</button>
            <button id="trigger-lights" class="btn">‚ú® –Ø–ª–∏–Ω–æ—á–∫–∞ –≥–æ—Ä–∏!</button>
        </div>
        
        <div class="status">
            <p id="mic-status">üé§ –ú—ñ–∫—Ä–æ—Ñ–æ–Ω: –≤–∏–º–∫–Ω–µ–Ω–æ</p>
            <p id="ar-status">üì± AR: –Ω–µ –∞–∫—Ç–∏–≤–Ω–∏–π</p>
            <p id="music-status">üéµ –ú—É–∑–∏–∫–∞: –≤–∏–º–∫–Ω–µ–Ω–æ</p>
        </div>
        
        <div class="instructions">
            <h3>üìã –Ø–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ç–∏—Å—è:</h3>
            <ol>
                <li>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–°—Ç–∞—Ä—Ç AR" —Ç–∞ –¥–æ–∑–≤–æ–ª—å—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–º–µ—Ä–∏</li>
                <li>–ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä (–∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –Ω–∏–∂—á–µ)</li>
                <li>–£–≤—ñ–º–∫–Ω—ñ—Ç—å –º—ñ–∫—Ä–æ—Ñ–æ–Ω —Ç–∞ —Å–∫–∞–∂—ñ—Ç—å "–Ø–ª–∏–Ω–æ—á–∫–∞ –≥–æ—Ä–∏!"</li>
                <li>–ê–±–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É "–Ø–ª–∏–Ω–æ—á–∫–∞ –≥–æ—Ä–∏!"</li>
                <li>–ù–∞—Å–æ–ª–æ–¥–∂—É–π—Ç–µ—Å—å –∞–Ω—ñ–º–∞—Ü—ñ—î—é –≤–æ–≥–Ω–∏–∫—ñ–≤!</li>
            </ol>
        </div>

        <div class="marker-section">
            <h3>üéØ –ú–∞—Ä–∫–µ—Ä –¥–ª—è AR:</h3>
            <p>–ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ —Ü–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è:</p>
            <img id="markerPreview" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjMDA0NDExIi8+CjxwYXRoIGQ9Ik0xMDAgMjVMMTQwIDc1TDE2MCA1NUwxMDAgMTVMMzAgODVMMzUgOTBMMTAwIDI1WiIgZmlsbD0iI0ZGREYwMCIvPgo8cGF0aCBkPSJNNzAgMTEwTDEwMCAxMzBMMTMwIDExMEwxMDAgOTBMNzAgMTEwWiIgZmlsbD0iI0ZGREYwMCIvPgo8cGF0aCBkPSJNNzAgMTQwTDEwMCAxNjBMMTMwIDE0MEwxMDAgMTIwTDcwIDE0MFoiIGZpbGw9IiNGRkRGMDAiLz4KPHBhdGggZD0iTTQ1IDE2MEw4NSAxODBMMTA1IDE2MEw0NSAxMTBMNDUgMTYwWiIgZmlsbD0iI0ZGREYwMCIvPgo8cGF0aCBkPSJNMTU1IDE2MEwxOTUgMTgwTDE3NSAxNjBMMTU1IDE0MEwxNTUgMTYwWiIgZmlsbD0iI0ZGREYwMCIvPgo8L3N2Zz4K" alt="–ú–∞—Ä–∫–µ—Ä —è–ª–∏–Ω–∫–∏">
            <p><small>–°–∫–∞—á–∞–π—Ç–µ —Ç–∞ —Ä–æ–∑–¥—Ä—É–∫—É–π—Ç–µ —Ü–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∞–±–æ –≤—ñ–¥–∫—Ä–∏–π—Ç–µ –Ω–∞ —ñ–Ω—à–æ–º—É –ø—Ä–∏—Å—Ç—Ä–æ—ó</small></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // –ï–ª–µ–º–µ–Ω—Ç–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è
            const startButton = document.getElementById('start-button');
            const musicToggle = document.getElementById('music-toggle');
            const micToggle = document.getElementById('mic-toggle');
            const triggerLights = document.getElementById('trigger-lights');
            const micStatus = document.getElementById('mic-status');
            const arStatus = document.getElementById('ar-status');
            const musicStatus = document.getElementById('music-status');
            
            let arStarted = false;
            let isMusicPlaying = false;
            let isMicActive = false;
            let recognition;
            let mindarThree;
            let scene;
            let garlandLights = [];
            
            // –ê—É–¥—ñ–æ –µ–ª–µ–º–µ–Ω—Ç –¥–ª—è –º—É–∑–∏–∫–∏
            const backgroundMusic = new Audio();
            
            // –°–ø–∏—Å–æ–∫ –º–æ–∂–ª–∏–≤–∏—Ö —Ñ–æ—Ä–º–∞—Ç—ñ–≤ –º—É–∑–∏–∫–∏ (–≤–∏–±–µ—Ä–∏ —Ç–æ–π, —è–∫–∏–π —É —Ç–µ–±–µ —î)
            const musicFormats = [
                'music.mp3',           // MP3 —Ñ–∞–π–ª
                'music.ogg',           // OGG —Ñ–∞–π–ª
                'music.wav',           // WAV —Ñ–∞–π–ª
                'background.mp3',      // –Ü–Ω—à—ñ –º–æ–∂–ª–∏–≤—ñ –Ω–∞–∑–≤–∏
                'bgmusic.mp3',
                'melody.mp3',
                'christmas.mp3'
            ];
            
            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º—É–∑–∏–∫–∏
            async function loadMusic() {
                for (const format of musicFormats) {
                    try {
                        // –°–ø—Ä–æ–±—É—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–æ–∂–µ–Ω —Ñ–æ—Ä–º–∞—Ç
                        backgroundMusic.src = format;
                        backgroundMusic.load();
                        
                        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –º–æ–∂–µ –±—Ä–∞—É–∑–µ—Ä –≤—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏ —Ü–µ–π —Ñ–æ—Ä–º–∞—Ç
                        const canPlay = await new Promise((resolve) => {
                            const checkPlay = () => {
                                const canPlay = backgroundMusic.canPlayType('audio/mpeg') || 
                                               backgroundMusic.canPlayType('audio/ogg') || 
                                               backgroundMusic.canPlayType('audio/wav');
                                resolve(canPlay);
                            };
                            backgroundMusic.addEventListener('canplaythrough', checkPlay);
                            backgroundMusic.addEventListener('error', () => resolve(false));
                            
                            // –¢–∞–π–º–∞—É—Ç –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
                            setTimeout(() => resolve(false), 2000);
                        });
                        
                        if (canPlay) {
                            console.log(`–ú—É–∑–∏–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞: ${format}`);
                            showMessage(`–ú—É–∑–∏–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞: ${format}`);
                            backgroundMusic.loop = true;
                            backgroundMusic.volume = 0.5;
                            return true;
                        }
                    } catch (error) {
                        console.log(`–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ ${format}:`, error);
                        continue;
                    }
                }
                
                // –Ø–∫—â–æ –∂–æ–¥–µ–Ω —Ñ–∞–π–ª –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ
                console.warn('–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∂–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª—É –º—É–∑–∏–∫–∏');
                showMessage('–§–∞–π–ª –º—É–∑–∏–∫–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –î–æ–¥–∞–π—Ç–µ music.mp3 –≤ –ø–∞–ø–∫—É –ø—Ä–æ—î–∫—Ç—É.');
                musicToggle.disabled = true;
                musicToggle.textContent = 'üéµ –ù–µ–º–∞—î –º—É–∑–∏–∫–∏';
                musicToggle.style.background = '#757575';
                return false;
            }
            
            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–æ–∫–∞–∑—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
            function showMessage(text, duration = 3000) {
                const message = document.createElement('div');
                message.className = 'message';
                message.textContent = text;
                document.body.appendChild(message);
                
                setTimeout(() => {
                    message.style.opacity = '0';
                    setTimeout(() => message.remove(), 300);
                }, duration);
            }
            
            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è MindAR
            async function initAR() {
                try {
                    const mindarThree = new MindARThree({
                        container: document.getElementById('ar-scene'),
                        imageTargetSrc: 'marcher.mind',
                        uiScanning: false,
                        uiLoading: true,
                        filterMinCF: 0.001,
                        filterBeta: 0.01,
                    });
                    
                    const { renderer, scene: threeScene, camera } = mindarThree;
                    
                    // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∞
                    renderer.setPixelRatio(window.devicePixelRatio);
                    renderer.setSize(document.getElementById('ar-scene').offsetWidth, 
                                    document.getElementById('ar-scene').offsetHeight);
                    
                    // –î–æ–¥–∞—î–º–æ —Å–≤—ñ—Ç–ª–æ
                    const light = new THREE.DirectionalLight(0xffffff, 1);
                    light.position.set(0, 0, 1);
                    threeScene.add(light);
                    
                    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
                    threeScene.add(ambientLight);
                    
                    // –°—Ç–≤–æ—Ä—é—î–º–æ –≥—ñ—Ä–ª—è–Ω–¥—É (–ø—Ä–∏–º—ñ—Ç–∏–≤–∏ —É —Ñ–æ—Ä–º—ñ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞)
                    createGarland(threeScene);
                    
                    // –°—Ç–∞—Ä—Ç AR
                    await mindarThree.start();
                    
                    // –û–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞—Ç—É—Å
                    arStatus.textContent = 'üì± AR: –∞–∫—Ç–∏–≤–Ω–∏–π';
                    arStatus.style.color = '#4CAF50';
                    
                    // –ê–Ω—ñ–º–∞—Ü—ñ—è
                    mindarThree.update();
                    renderer.setAnimationLoop(() => {
                        renderer.render(threeScene, camera);
                    });
                    
                    return { mindarThree, scene: threeScene };
                } catch (error) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó AR:', error);
                    arStatus.textContent = 'üì± AR: –ø–æ–º–∏–ª–∫–∞';
                    arStatus.style.color = '#f44336';
                    showMessage('–ü–æ–º–∏–ª–∫–∞ AR. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–º–µ—Ä–∏ —Ç–∞ —Ñ–∞–π–ª marcher.mind');
                    return null;
                }
            }
            
            // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≥—ñ—Ä–ª—è–Ω–¥–∏
            function createGarland(scene) {
                const garlandGeometry = new THREE.SphereGeometry(0.02, 8, 8);
                const garlandMaterial = new THREE.MeshBasicMaterial({ 
                    color: 0x333300,
                    transparent: true,
                    opacity: 0.8
                });
                
                // –°—Ç–≤–æ—Ä—é—î–º–æ –≤–æ–≥–Ω–∏–∫–∏ —É —Ñ–æ—Ä–º—ñ —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞ (—è–ª–∏–Ω–∫–∞)
                const trianglePoints = [
                    // –í–µ—Ä—Ö–Ω—ñ–π —Ä—è–¥
                    { x: 0, y: 0.4, z: 0 },
                    // –°–µ—Ä–µ–¥–Ω—ñ–π —Ä—è–¥
                    { x: -0.15, y: 0.25, z: 0 },
                    { x: 0, y: 0.25, z: 0 },
                    { x: 0.15, y: 0.25, z: 0 },
                    // –ù–∏–∂–Ω—ñ–π —Ä—è–¥
                    { x: -0.25, y: 0.1, z: 0 },
                    { x: -0.1, y: 0.1, z: 0 },
                    { x: 0.1, y: 0.1, z: 0 },
                    { x: 0.25, y: 0.1, z: 0 },
                    // –ù–∞–π–Ω–∏–∂—á–∏–π —Ä—è–¥
                    { x: -0.3, y: -0.05, z: 0 },
                    { x: -0.15, y: -0.05, z: 0 },
                    { x: 0, y: -0.05, z: 0 },
                    { x: 0.15, y: -0.05, z: 0 },
                    { x: 0.3, y: -0.05, z: 0 },
                    // –û—Å–Ω–æ–≤–∞
                    { x: 0, y: -0.2, z: 0 }
                ];
                
                trianglePoints.forEach((point, index) => {
                    const light = new THREE.Mesh(garlandGeometry, garlandMaterial.clone());
                    light.position.set(point.x, point.y, point.z);
                    scene.add(light);
                    garlandLights.push({
                        mesh: light,
                        material: light.material,
                        originalColor: 0x333300,
                        activeColor: 0xffff00,
                        isActive: false
                    });
                });
            }
            
            // –ê–Ω—ñ–º–∞—Ü—ñ—è –≤–æ–≥–Ω–∏–∫—ñ–≤
            function animateLights() {
                if (garlandLights.length === 0) return;
                
                garlandLights.forEach((lightObj, index) => {
                    setTimeout(() => {
                        lightObj.isActive = true;
                        lightObj.material.color.setHex(lightObj.activeColor);
                        lightObj.material.opacity = 1;
                        
                        // –ï—Ñ–µ–∫—Ç –º–µ—Ä–µ—Ö—Ç—ñ–Ω–Ω—è
                        const interval = setInterval(() => {
                            if (lightObj.isActive) {
                                const intensity = 0.7 + Math.random() * 0.3;
                                const flickerColor = Math.floor(lightObj.activeColor * intensity);
                                lightObj.material.color.setHex(flickerColor);
                                lightObj.material.opacity = 0.7 + Math.random() * 0.3;
                            } else {
                                clearInterval(interval);
                            }
                        }, 100);
                        
                        // –í–∏–º–∏–∫–∞—î–º–æ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
                        setTimeout(() => {
                            lightObj.isActive = false;
                            lightObj.material.color.setHex(lightObj.originalColor);
                            lightObj.material.opacity = 0.8;
                            clearInterval(interval);
                        }, 5000);
                    }, index * 150);
                });
            }
            
            // –ì–æ–ª–æ—Å–æ–≤–µ –∫–µ—Ä—É–≤–∞–Ω–Ω—è
            function initVoiceRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    recognition = new SpeechRecognition();
                    recognition.continuous = true;
                    recognition.interimResults = false;
                    recognition.lang = 'uk-UA';
                    
                    recognition.onresult = (event) => {
                        const transcript = event.results[event.results.length - 1][0].transcript;
                        console.log('–†–æ–∑–ø—ñ–∑–Ω–∞–Ω–æ:', transcript);
                        
                        if (transcript.toLowerCase().includes('—è–ª–∏–Ω–æ—á–∫–∞ –≥–æ—Ä–∏')) {
                            showMessage('–†–æ–∑–ø—ñ–∑–Ω–∞–Ω–æ: "–Ø–ª–∏–Ω–æ—á–∫–∞ –≥–æ—Ä–∏!"');
                            animateLights();
                        }
                    };
                    
                    recognition.onerror = (event) => {
                        console.error('–ü–æ–º–∏–ª–∫–∞ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è:', event.error);
                        micStatus.textContent = 'üé§ –ú—ñ–∫—Ä–æ—Ñ–æ–Ω: –ø–æ–º–∏–ª–∫–∞';
                        micStatus.style.color = '#f44336';
                        showMessage('–ü–æ–º–∏–ª–∫–∞ –º—ñ–∫—Ä–æ—Ñ–æ–Ω–∞');
                    };
                    
                    recognition.onend = () => {
                        if (isMicActive) {
                            setTimeout(() => recognition.start(), 100);
                        }
                    };
                } else {
                    console.warn('Web Speech API –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è');
                    micToggle.disabled = true;
                    micToggle.textContent = 'üé§ –ù–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è';
                    micToggle.style.background = '#757575';
                    micStatus.textContent = 'üé§ –ú—ñ–∫—Ä–æ—Ñ–æ–Ω: –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è';
                }
            }
            
            // –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π
            startButton.addEventListener('click', async () => {
                if (!arStarted) {
                    startButton.disabled = true;
                    startButton.textContent = 'üîÑ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...';
                    
                    const ar = await initAR();
                    if (ar) {
                        mindarThree = ar.mindarThree;
                        scene = ar.scene;
                        arStarted = true;
                        startButton.textContent = '‚èπÔ∏è –°—Ç–æ–ø AR';
                        startButton.style.background = '#f44336';
                        startButton.classList.add('active');
                    } else {
                        startButton.textContent = 'üöÄ –°—Ç–∞—Ä—Ç AR';
                    }
                    startButton.disabled = false;
                } else {
                    if (mindarThree) {
                        mindarThree.stop();
                    }
                    arStarted = false;
                    startButton.textContent = 'üöÄ –°—Ç–∞—Ä—Ç AR';
                    startButton.style.background = '#2d5a27';
                    startButton.classList.remove('active');
                    arStatus.textContent = 'üì± AR: –Ω–µ –∞–∫—Ç–∏–≤–Ω–∏–π';
                    arStatus.style.color = 'white';
                }
            });
            
            musicToggle.addEventListener('click', () => {
                if (isMusicPlaying) {
                    backgroundMusic.pause();
                    musicToggle.textContent = 'üéµ –£–≤—ñ–º–∫. –º—É–∑–∏–∫—É';
                    musicToggle.style.background = '#2d5a27';
                    musicToggle.classList.remove('active');
                    musicStatus.textContent = 'üéµ –ú—É–∑–∏–∫–∞: –≤–∏–º–∫–Ω–µ–Ω–æ';
                    isMusicPlaying = false;
                } else {
                    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞ –º—É–∑–∏–∫–∞
                    if (!backgroundMusic.src || backgroundMusic.error) {
                        showMessage('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º—É–∑–∏–∫–∏...');
                        loadMusic().then(success => {
                            if (success) {
                                playMusic();
                            }
                        });
                    } else {
                        playMusic();
                    }
                }
                
                function playMusic() {
                    backgroundMusic.play()
                        .then(() => {
                            musicToggle.textContent = 'üîá –í–∏–º–∫. –º—É–∑–∏–∫—É';
                            musicToggle.style.background = '#4CAF50';
                            musicToggle.classList.add('active');
                            musicStatus.textContent = 'üéµ –ú—É–∑–∏–∫–∞: –≥—Ä–∞—î';
                            musicStatus.style.color = '#4CAF50';
                            isMusicPlaying = true;
                            showMessage('–ú—É–∑–∏–∫–∞ —É–≤—ñ–º–∫–Ω–µ–Ω–∞');
                        })
                        .catch(error => {
                            console.error('–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –º—É–∑–∏–∫–∏:', error);
                            showMessage('–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –º—É–∑–∏–∫–∏. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å —â–µ —Ä–∞–∑.');
                            musicToggle.textContent = 'üéµ –ü–æ–º–∏–ª–∫–∞';
                            musicToggle.style.background = '#f44336';
                        });
                }
            });
            
            micToggle.addEventListener('click', () => {
                if (!recognition) {
                    initVoiceRecognition();
                }
                
                if (isMicActive) {
                    recognition.stop();
                    micStatus.textContent = 'üé§ –ú—ñ–∫—Ä–æ—Ñ–æ–Ω: –≤–∏–º–∫–Ω–µ–Ω–æ';
                    micStatus.style.color = 'white';
                    micToggle.textContent = 'üé§ –£–≤—ñ–º–∫. –º—ñ–∫—Ä–æ—Ñ–æ–Ω';
                    micToggle.style.background = '#2d5a27';
                    micToggle.classList.remove('active');
                } else {
                    try {
                        recognition.start();
                        micStatus.textContent = 'üé§ –ú—ñ–∫—Ä–æ—Ñ–æ–Ω: –∞–∫—Ç–∏–≤–Ω–∏–π';
                        micStatus.style.color = '#4CAF50';
                        micToggle.textContent = 'üé§ –í–∏–º–∫. –º—ñ–∫—Ä–æ—Ñ–æ–Ω';
                        micToggle.style.background = '#f44336';
                        micToggle.classList.add('active');
                        showMessage('–ú—ñ–∫—Ä–æ—Ñ–æ–Ω –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ');
                    } catch (error) {
                        console.error('–ü–æ–º–∏–ª–∫–∞ –º—ñ–∫—Ä–æ—Ñ–æ–Ω–∞:', error);
                        micStatus.textContent = 'üé§ –ú—ñ–∫—Ä–æ—Ñ–æ–Ω: –ø–æ–º–∏–ª–∫–∞';
                        micStatus.style.color = '#f44336';
                        showMessage('–ü–æ–º–∏–ª–∫–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –º—ñ–∫—Ä–æ—Ñ–æ–Ω–∞');
                    }
                }
                isMicActive = !isMicActive;
            });
            
            triggerLights.addEventListener('click', () => {
                if (arStarted) {
                    animateLights();
                    triggerLights.style.background = '#FF9800';
                    triggerLights.classList.add('active');
                    showMessage('–Ø–ª–∏–Ω–æ—á–∫–∞ –≥–æ—Ä–∏! ‚ú®');
                    
                    setTimeout(() => {
                        triggerLights.style.background = '#2d5a27';
                        triggerLights.classList.remove('active');
                    }, 500);
                } else {
                    showMessage('–°–ø–æ—á–∞—Ç–∫—É –∑–∞–ø—É—Å—Ç—ñ—Ç—å AR!', 2000);
                }
            });
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–º–∫–Ω–µ–Ω–Ω—è –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ
            window.addEventListener('beforeunload', () => {
                if (recognition && isMicActive) {
                    recognition.stop();
                }
                if (mindarThree) {
                    mindarThree.stop();
                }
                if (backgroundMusic) {
                    backgroundMusic.pause();
                }
            });
            
            // –ê–¥–∞–ø—Ç–∞—Ü—ñ—è —Ä–æ–∑–º—ñ—Ä—É AR –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            window.addEventListener('resize', () => {
                if (mindarThree && mindarThree.renderer) {
                    const container = document.getElementById('ar-scene');
                    mindarThree.renderer.setSize(container.offsetWidth, container.offsetHeight);
                }
            });
            
            // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º—É–∑–∏–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
            loadMusic();
            
            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è
            initVoiceRecognition();
        });
    </script>
</body>
</html>
